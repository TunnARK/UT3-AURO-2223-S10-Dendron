<h1 id="exemple---repo-github">Exemple - Repo GitHub<a aria-hidden="true" class="anchor-heading icon-link" href="#exemple---repo-github"></a></h1>
<blockquote>
<p><strong>Avertissement:</strong>
Cette page peut contenir des fautes ! Envoyez-moi un message sur <a href="https://matrix.to/#/#UT3-AURO-M2-2223-Request:matrix.org"><code>#UT3-AURO-M2-2223-Request:matrix.org</code></a> si vous en trouvez, merci.</p>
</blockquote>
<blockquote>
<p>Cours donné par G. Saurel</p>
</blockquote>
<p>Support de cours:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/TunnARK/UT3-AURO-2223-S10-Dendron/main/vault/assets/COOSTART.NotesGEA.20220901.pdf">COOSTART.NotesGEA.20220901.pdf</a></li>
<li><a href="https://github.com/nim65s/conception-orientee-objet">Lien vers le Repo GitHub</a></li>
</ul>
<hr>
<blockquote>
<p>Notes du 2022/09/01 - Start</p>
</blockquote>
<h1 id="introduction">Introduction<a aria-hidden="true" class="anchor-heading icon-link" href="#introduction"></a></h1>
<h2 id="github">GitHub<a aria-hidden="true" class="anchor-heading icon-link" href="#github"></a></h2>
<p>Forges = type de logiciel de gestion de version et de projet.</p>
<p>Ici on va utiliser GitHub.</p>
<h3 id="créer-un-projet-github">Créer un projet GitHub<a aria-hidden="true" class="anchor-heading icon-link" href="#créer-un-projet-github"></a></h3>
<ul>
<li>Créer un compte github.com</li>
<li>Configurer une clé crypto pour communiquer avec GitHub depuis le terminal</li>
<li>Create "New Repository"</li>
<li>Choisir l'owner
<ul>
<li>peut etre une personne (compte perso)</li>
<li>mais peut aussi etre une organisation (compte pro)</li>
</ul>
</li>
<li>Choisir un nom pour le projet
<ul>
<li>éviter les noms communs car il sera plus difficile à trouver</li>
<li>ne mettre que des minuscule pour ne pas compliquer le site URL</li>
</ul>
</li>
<li>Rajouter une description</li>
<li>Choisir si le projet sera privée ou public</li>
<li>Rajouter un README</li>
<li>Ignorer le gitignore pour maintenant</li>
<li>Pour le choix de licence, toute creation a droit a une licence toujours mieux de le faire ici on va choisir BSD 2 clause</li>
<li>Lancer le projet</li>
</ul>
<p>Le projet contiendra automatiquement un fichier license et un readme.</p>
<h3 id="commit">Commit<a aria-hidden="true" class="anchor-heading icon-link" href="#commit"></a></h3>
<ul>
<li>
<p>Visiter le lien <a href="https://github.com/nim65s/conception-orientee-objet">https://github.com/nim65s/conception-orientee-objet</a></p>
</li>
<li>
<p>Cliquer sur commits</p>
</li>
<li>
<p>Lorsqu'on veut ajouter un fichier dans le projet on réalise un commit qui contient un titre et une description pour expliquer quest-ce qui est ajouté/modifié au projet</p>
</li>
</ul>
<h3 id="includesrc">Include/SRC<a aria-hidden="true" class="anchor-heading icon-link" href="#includesrc"></a></h3>
<p>La structure du git sera expliqué plus tard.</p>
<h2 id="adder">Adder<a aria-hidden="true" class="anchor-heading icon-link" href="#adder"></a></h2>
<p>???</p>
<h2 id="include">Include<a aria-hidden="true" class="anchor-heading icon-link" href="#include"></a></h2>
<p><code>#include file.hpp</code></p>
<p>dis au compilateur d'inclure le contenu de la librairie <code>file.hpp</code></p>
<p>Ce fichier commence avec un <code>#ifndef</code> pour dire au compuilateur que si cette librairie n'a pas déjà été crée alors il l'a définie sinon il ne l'inclut pas car elle a déjà était inclut précédemment.</p>
<h2 id="cmake">CMake<a aria-hidden="true" class="anchor-heading icon-link" href="#cmake"></a></h2>
<ul>
<li>Créer un fichier <code>CMakeList.txt</code></li>
<li>On choisit la version de CMake (à décider avant de créer le projet selon ses besoins)
<ul>
<li><code>cmake_minimum_required(VERSION 3.18)</code></li>
<li>ici on prend une version récente pour voir les nouvelles fonctionnalités</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Puis on déclare un projet CMake pour faire la bijection avec le projet Git</p>
<ul>
<li>
<pre><code>project(
  Conception-Orientee-Objet
  VERSION 0.1.0 \\ semantic versionning
  DESCRIPTION "example project for a class"
  HOMEPAGE_URL "https://github.com/nim65s/conception-orientee-objet"
  LANGUAGES CXX
  )
</code></pre>
</li>
</ul>
</li>
<li>
<p>Il faut ensuite indiquer la librairie</p>
<ul>
<li>choisir si la lib est static (.a ou .o sur win) ou dynamic (.so)
<ul>
<li>static on a tout sur le fichier exécutable</li>
<li>dynamic va seulement faire des liens entre lib et exe donc il ne faudra pas à chaque fois recréer un exe</li>
</ul>
</li>
<li>ici on considère du dynamic ici donc on va rajouter <code>SHARED</code></li>
<li>
<pre><code>add_library(
  example-adder SHARED include/conception-orientee-objet/example-adder.hpp
                     src/example-adder.cpp
  )
</code></pre>
</li>
</ul>
<pre><code></code></pre>
</li>
</ul>
<ul>
<li>
<p>Finalement il faut indiquer au projet CMake la target </p>
<ul>
<li>
<pre><code>target_include_directories(
  example-adder PUBLIC $&#x3C;BUILD_INTERFACE:${CMAKE_SOURCE_DIR}/include>
  )
</code></pre>
</li>
</ul>
<pre><code></code></pre>
</li>
</ul>
<p>Maintenant on peut exécuter CMake avec la commande <code>cmake -S . -B build</code></p>
<ul>
<li>
<p>elle va verifier que le projet a les bonnes versions ainsi que les bons compilateurs et les bonnes dépendances</p>
</li>
<li>
<p><code>-S .</code> informe CMake le path vers la source</p>
</li>
<li>
<p><code>-B build</code> créer un dossier build contenant les fichier temporaire sur les versions, compilateurs et dépendances que cmake à trouver</p>
</li>
<li>
<p>On lance ensuite la commande <code>cmake --build build</code></p>
<ul>
<li>ceci va créer la lib dynamic <code>libexample-adder.so</code></li>
</ul>
</li>
</ul>
<h2 id="executable">Executable<a aria-hidden="true" class="anchor-heading icon-link" href="#executable"></a></h2>
<ul>
<li>
<p>On crée un fichier main <code>adder.cpp</code></p>
</li>
<li>
<p>ici on choisit d'utiliser <code>return EXIT_FAILURE;</code> <code>return EXIT_SUCCESS;</code> (donné de base par la lib cpp standard) au lieu de faire un <code>return 0;</code></p>
</li>
<li>
<p><code>argc</code> paramètre</p>
</li>
<li>
<p><code>argv</code> <em>arg vemus</em></p>
</li>
<li>
<p>si maintenant on lance <code>./adder 8 8</code> le compilateur va faire des liens dynamic entre la lib et l'exécutable</p>
</li>
<li>
<p><code>ldd</code> va lancer un exécutable et vérifier ce que cette exe a besoin pour se lancer</p>
</li>
</ul>
<h2 id="pushpull">PUSH/PULL<a aria-hidden="true" class="anchor-heading icon-link" href="#pushpull"></a></h2>
<ul>
<li>
<p>PUSH va synchroniser les modifs faite dans dossier local</p>
</li>
<li>
<p>PULL va récuperer les modifs faites par le collaborateur et donc synchroniser les nouveautés sur GitHub en les installant sur mon local</p>
</li>
<li>
<p>Commit correspond à unité de changment</p>
</li>
</ul>
<h1 id="explication-commits">Explication Commits<a aria-hidden="true" class="anchor-heading icon-link" href="#explication-commits"></a></h1>
<h2 id="test">Test<a aria-hidden="true" class="anchor-heading icon-link" href="#test"></a></h2>
<ul>
<li>
<p>Ctest définie une option <code>BUILD_TESTING</code></p>
</li>
<li>
<p>On crée un main test pour y faire des <code>assert</code></p>
</li>
<li>
<p><code>assert(coo::add())</code> on indique a assert de chercher la fct add du <strong>namespace</strong> coo</p>
</li>
<li>
<p>un namespace est un dossier contenant les listes des fct</p>
</li>
<li>
<p>En recompilant le dossier build les tests vont etre verifier (si on obtient aucune erreur alors penser un forcer un test false pour verifier que les test ont bien été réalisé)</p>
</li>
<li>
<p>On parle de test unitaire car le test va assertifié une partie (une unité) du programme (ou bien fonction par fonction ou classe par classe)</p>
</li>
</ul>
<h2 id="module-python">Module Python<a aria-hidden="true" class="anchor-heading icon-link" href="#module-python"></a></h2>
<ul>
<li>
<p>On ajoute au <code>CMakeLists.txt</code> un build interface pour python</p>
<ul>
<li>ici on choisit de faire des bindings python avec <code>boost</code>
<ul>
<li>Boost est une librairie Python contenant les dernières fctionnalités pas encore intégré sur le stable</li>
</ul>
</li>
<li>ici on garde boost mais plus tard on passera sur pybind11</li>
</ul>
</li>
<li>
<p><code>Boost</code> c'est le projet CMake</p>
</li>
<li>
<p><code>boost</code> lui est un nom de fichier (souvent en minuscule)</p>
</li>
<li>
<p><code>BOOST_PYTHON_MODULE</code> Macro CPP souvent en maj</p>
</li>
</ul>
<blockquote>
<p>Un jour CPP n'aura plus d'include ou de marco (qui viennent du C et que l'on cherche à supprimer)</p>
</blockquote>
<ul>
<li>ici on a code python binaire donc exe que sur un pc avec une architecture précise</li>
</ul>
<blockquote>
<p>Notes du 2022/09/01 - End</p>
</blockquote>
<hr>
<blockquote>
<p>Notes du 2022/09/07 - Start</p>
</blockquote>
<h2 id="commit-cmake-minimal-project">Commit: "CMake: minimal project"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-cmake-minimal-project"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/f5de5b63f91cbd9e50193c0accfe246d49bd961a">lien vers le commit "CMake: minimal project"</a></p>
</blockquote>
<ul>
<li>
<p>semantic versioning</p>
<ul>
<li>majeur</li>
<li>mineur</li>
<li>patch</li>
</ul>
</li>
<li>
<p>on incremente le num majeur pour indique de grosse modification comme changer le type d'une variable</p>
</li>
<li>
<p>on reste en version 0 tant que le projet n'est pas stable</p>
</li>
<li>
<p>certains mette l'annee au lieu de 0 dans le majeur</p>
</li>
</ul>
<h2 id="commit-add-an-executable">Commit: "add an executable"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-an-executable"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/36d4162c43d634aae59ab36457cc9b46d9eecd44">lien vers le commit "add an executable"</a></p>
</blockquote>
<p>le code faite la somme et retourne le resultat</p>
<p>il verifie aussi si on lui donne 2 param avec:</p>
<pre><code>std::cerr &#x3C;&#x3C; "This program needs 2 integers\n";
  return EXIT_FAILURE;
</code></pre>
<h2 id="commit-add-a-test">Commit: "add a test"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-a-test"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/b433b44d7b2ada9a538944dda4dd144b683ce928">lien vers le commit "add a test"</a></p>
</blockquote>
<ul>
<li>le fichier CMakeLists.txt est construit de façon modulaire
<ul>
<li>dans le root on indique au CMakeLists.txt les sousfichiers CMakeLists.txt
<pre><code>if(BUILD_TESTING)
  add_subdirectory(tests)
endif()
</code></pre>
</li>
<li>on peut aussi avoir un CMakeLists pour src et ainsi de suite</li>
</ul>
</li>
</ul>
<blockquote>
<p>Lien utile: <a href="/UT3-AURO-2223-S10-Dendron/ccpreference.com">ccpreference.com</a></p>
</blockquote>
<h2 id="commit-add-python-module">Commit: "add python module"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-python-module"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/2f4cd4a786e2ce7e2e242fce5dba685e06496fd1">lien vers le commit "add python module"</a></p>
</blockquote>
<ul>
<li>on indique a python comment compiler du cpp by linking la lib ainsi</li>
</ul>
<pre><code>python_add_library(conception_orientee_objet MODULE WITH_SOABI
                    conception_orientee_objet.cpp)
target_link_libraries(conception_orientee_objet PUBLIC example-adder
                                                        Boost::python)
</code></pre>
<h2 id="commit-add-python-wrapper-function">Commit: "add python wrapper function"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-python-wrapper-function"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/9522846c446151b9d87cf583b3b269425e4de479">lien vers le commit "add python wrapper function"</a></p>
</blockquote>
<ul>
<li>
<p>attention 3 methodes quand on fait des import</p>
<ul>
<li>fichier <code>adder.py</code></li>
<li>lib <code>adder.[...].so</code></li>
<li>dossier <code>adder/__init__.py</code></li>
</ul>
</li>
<li>
<p>ici on a importer un dossier</p>
<pre><code>from .binary_module import add as binary_add
</code></pre>
</li>
<li>
<p>cette fct va s'assurer d'adapter les params au type de la fct add pour que meme si on lui donne des params en <code>string</code> il les convertisse en <code>int</code></p>
</li>
<li>
<p><code>ipython</code> lance un terminal python</p>
<ul>
<li>on y test la fct add avec les param <code>3</code> et <code>"-4"</code> et avec le wrapper on a plus l'erreur de compatibilite de type et add retourne <code>-1</code></li>
<li>on peut aussi demander à <code>ipython</code> de donner des indications sur la fct en remplaçant les params par <code>?</code></li>
</ul>
</li>
<li>
<p>on utilise le mot <code>wrapper</code> pour indiquer qu'on encapsule des fonctionnalités supplémentaires sur la fct principal</p>
<ul>
<li>c'est comme rajouter des <em>features</em> à un système</li>
</ul>
</li>
</ul>
<h2 id="commit-add-python-unittests-">Commit: "add python unittests "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-python-unittests-"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/41ce3e0fbdf70dad0d81e3d598d94b0996202573">lien vers le commit "add python unittests "</a></p>
</blockquote>
<ul>
<li>
<p>on ajoute un fichier test pour vérifier si la fonction retourne les bons résultats</p>
</li>
<li>
<p>l'execution de <code>test_add.py</code> retourne 0 si aucune erreur n'est trouver dans la liste de test et retourne 1 si un des tests de la liste n'est pas vérifié</p>
</li>
</ul>
<h2 id="commit-let-ctest-run-python-unittests">Commit: "let CTest run python unittests"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-let-ctest-run-python-unittests"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/e155b740f31e0d9ad48f22d3c2b2dc4b68799825">lien vers le commit "let CTest run python unittests"</a></p>
</blockquote>
<ul>
<li>
<p>on rajoute un fichier qui va executer tous les tests unitaires</p>
</li>
<li>
<p>du coup il faut faire attention à comment on va importer les fichiers/dossiers</p>
</li>
<li>
<p>se rappeler que les imports se font sur 3 méthodes</p>
</li>
<li>
<p>pour bien indiquer où chercher les fichiers/dossiers à importer on donne au compilateur un <code>PYTHONPATH</code> (une liste de paths)</p>
<pre><code>set_tests_properties(test-python PROPERTIES ENVIRONMENT
                                            PYTHONPATH=${CMAKE_BINARY_DIR})
</code></pre>
</li>
</ul>
<h2 id="commit-add-doctest-examples-and-checks">Commit: "add doctest examples and checks"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-add-doctest-examples-and-checks"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/998c571a2785550406ab29efa74b9fa48a2b0d9e">lien vers le commit "add doctest examples and checks"</a></p>
</blockquote>
<ul>
<li>
<p>on donne un paragraphe contenant les tests à vérifier</p>
</li>
<li>
<p>advantage: on peut faire d'une pierre 2 coups car on donne la documentation dans les listes tests et ainsi la doc est utile pour l'utilisateur et la machine (plus besoin d'avoir une doc que pour les utilisateurs et une liste d'appel de fcts pour les tests)</p>
</li>
<li>
<p>une ligne <code>...</code> sera comprise par doctest comme ignorer un bloc de ligne sur le résultat du terminal</p>
</li>
</ul>
<h2 id="commit-setup-pre-commit">Commit: "setup pre-commit"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-setup-pre-commit"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/85bda769d361aaf3aa450698f8d8bb194461403d">lien vers le commit "setup pre-commit"</a></p>
</blockquote>
<ul>
<li>il est conseillé de rajouter les outils au départ d'un projet meme si ici cela a été rajouté pour rendre le cours plus fluide</li>
</ul>
<h2 id="commit-setup-github-actions">Commit: "setup github actions"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-setup-github-actions"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/e54277a90fe8996c676cb38d6b6e27e511a1c20a">lien vers le commit "setup github actions"</a></p>
</blockquote>
<ul>
<li>
<p>on fait le push et pre-commit.ci va s'occuper de faire les tests pre-commit pour nous avons de publier</p>
</li>
<li>
<p>pour ce faire on ecrit un fichier <code>yaml</code> pour executer des GitHub Actions</p>
<ul>
<li>premier job fait le build pour voir que tout fonctionne en faisant un <code>checkout</code> puis plusieurs executions:</li>
</ul>
<pre><code>  build:
  runs-on: ubuntu-latest
  steps:
  - uses: actions/checkout@v3

  - name: install Ubuntu dependencies
    run: sudo apt install libboost-python-dev python-is-python3 python3-pip

  - name: install PyPI dependencies
    run: pip install -U pip &#x26;&#x26; pip install -U cmake

  - name: configure the project
    run: cmake -B build -S .

  - name: build the project
    run: cmake --build build

  - uses: actions/upload-artifact@v3
    with:
      name: build
      path: build
</code></pre>
<ul>
<li>
<p>intégration continue: important de run ces actions sur plusieurs OS (ici on a fait les actions pour Ubuntu seulement)</p>
</li>
<li>
<p>on rajoute une liste d'actions pour les tests</p>
<pre><code>  test:
runs-on: ubuntu-latest
needs: "build"
steps:
- uses: actions/checkout@v3

- name: install Ubuntu dependencies
  run: sudo apt install libboost-python-dev python-is-python3 python3-pip

- name: install PyPI dependencies
  run: pip install -U pip &#x26;&#x26; pip install -U cmake

- uses: actions/download-artifact@v3
  with:
    name: build
    path: build

- run: ls build
- run: ls build/tests
- run: ls build/conception_orientee_objet

- name: test the project
  run: cmake --build build -t test
  env:
    CTEST_OUTPUT_ON_FAILURE: "ON"
</code></pre>
</li>
<li>
<p>Attention: par défaut CTEST n'indique pas d'indice sur les tests failed donc il faut lui demander en paramétrant le suivant sur ON </p>
<p><code>CTEST_OUTPUT_ON_FAILURE: "ON"</code></p>
</li>
</ul>
</li>
</ul>
<h2 id="commit-boostpython--pybind11-">Commit: "Boost::python → pybind11 "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-boostpython--pybind11-"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/d21be5053db17a34c6eef44faac814a9922f7fe6">lien vers le commit "Boost::python → pybind11 "</a></p>
</blockquote>
<p>puisque la lib pythonboost n'est pas facilement installable on decide d'utiliser une autre lib pybind11 du coup on implémente tous les changements nécessaires</p>
<h2 id="commit-ci-upgrade-python">Commit: "CI: upgrade python"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-ci-upgrade-python"></a></h2>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/ffb2a8c5f7947de3cc9ff6645c060e6f5af75f72">lien vers le commit "CI: upgrade python"</a></p>
</blockquote>
<p>Un changement à ne pas oublier c'est d'adapter les actions</p>
<h2 id="templates">Templates<a aria-hidden="true" class="anchor-heading icon-link" href="#templates"></a></h2>
<p>il est possible d'utiliser un répertoire comme template pour créer des projets contenant déjà du contenu</p>
<h2 id="extra-et-logique">Extra: ET Logique<a aria-hidden="true" class="anchor-heading icon-link" href="#extra-et-logique"></a></h2>
<ul>
<li><code>&#x26;</code>: et logique</li>
<li><code>and</code>: equivalant du <code>&#x26;&#x26;</code> en C</li>
</ul>
<blockquote>
<p>Notes du 2022/09/07 - End</p>
</blockquote>
<hr>
<blockquote>
<p>Notes du 2022/09/14 - Start</p>
</blockquote>
<h1 id="deployement">Deployement<a aria-hidden="true" class="anchor-heading icon-link" href="#deployement"></a></h1>
<h2 id="structure-et-gestion-des-dossiers">Structure et Gestion des dossiers<a aria-hidden="true" class="anchor-heading icon-link" href="#structure-et-gestion-des-dossiers"></a></h2>
<h3 id="contexte">Contexte<a aria-hidden="true" class="anchor-heading icon-link" href="#contexte"></a></h3>
<p>COOSATR.GitHubExemple.PicTree</p>
<h3 id="bonne-pratique">Bonne pratique<a aria-hidden="true" class="anchor-heading icon-link" href="#bonne-pratique"></a></h3>
<p>Attention:</p>
<ul>
<li>éviter de tous mettre dans le root <code>\</code></li>
<li>git est hierarchique du coup on va plutot utiliser des préfixes <code>$PREFIX</code></li>
<li>3 prefix par défaut: <code>\</code> <code>\usr\</code> ou <code>\usr\local\</code></li>
<li>pb par securite pas tout le monde ne peut ecrire directe dans ces prefix => on prefere travailler sur <code>\tmp\</code> un dossier temporaire git n'est present que sur la RAM et s'efface quand on eteint l'ordi</li>
</ul>
<p>par convention on prefere mettre les binaires dans un dossier <code>\bin\</code> et les librairies dans un dossier <code>\lib\</code></p>
<h3 id="how-to">How to<a aria-hidden="true" class="anchor-heading icon-link" href="#how-to"></a></h3>
<p><code>export PATH=/tmp/install/bin:$PATH</code> rajoute le path <code>/tmp/install/bin</code> dans la liste de tous les path (ici en debut de liste)</p>
<h2 id="utiliser-cmake-pour-lancer-le-deployment">Utiliser CMake pour lancer le deployment<a aria-hidden="true" class="anchor-heading icon-link" href="#utiliser-cmake-pour-lancer-le-deployment"></a></h2>
<h3 id="commit--install-targets--files-">Commit: " install targets &#x26; files "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit--install-targets--files-"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/7e670ce3b115695668dcd23cb15cd575a654f569">lien vers le commit " install targets &#x26; files "</a></p>
</blockquote>
<pre class="language-cmake"><code class="language-CMake"><span class="token keyword">install</span><span class="token punctuation">(</span>TARGETS example-adder adder<span class="token punctuation">)</span>
<span class="token keyword">install</span><span class="token punctuation">(</span>FILES include/conception-orientee-objet/example-adder.hpp
        DESTINATION include/conception-orientee-objet<span class="token punctuation">)</span>
</code></pre>
<ul>
<li>lancer <code>cmake --install build</code> retournera une erreur car il va vouloir installer le build dans <code>/usr/local/</code> or ce dossier necessite les droits admin pour y modifier le contenu</li>
<li>pour eviter de casser son ordi on va faire l'install dans <code>/tmp/</code> comme preciser ci-dessus</li>
<li>du coup on lance la commande <code>cmake -B buil -S. -DCMAKE_INSTALL_PREFIX=${{ github.workspace }}/install</code></li>
</ul>
<h2 id="packaging">Packaging<a aria-hidden="true" class="anchor-heading icon-link" href="#packaging"></a></h2>
<ul>
<li>mettre un dossier dans un zip ou tar pour partager ce dossier à d'autres coequipier</li>
<li>on peut par exemple creer ainsi des packet binaire <code>deb</code></li>
</ul>
<h2 id="cmake-export">CMake Export<a aria-hidden="true" class="anchor-heading icon-link" href="#cmake-export"></a></h2>
<blockquote>
<p>Comment permettre à d'autres d'utiliser mon projet</p>
</blockquote>
<p>C'est la pierre angulaire de cmake car il automatise la routine de gestion des depandonces</p>
<h3 id="commit-install-exports-">Commit: "install exports "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-install-exports-"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/3f5152ec477b11e6984c05cfd147d696b29bdfa4">lien vers le commit "install exports "</a></p>
</blockquote>
<ul>
<li>
<p>Dans cmakelist principal on rajoute ces lignes pour indiquer où chercher mes header</p>
<pre class="language-cmake"><code class="language-CMake">example-adder <span class="token namespace">PUBLIC</span> <span class="token punctuation">$&#x3C;</span>BUILD_INTERFACE:<span class="token punctuation">${</span><span class="token variable">CMAKE_SOURCE_DIR</span><span class="token punctuation">}</span>/include<span class="token punctuation">></span>
                      <span class="token punctuation">$&#x3C;</span>INSTALL_INTERFACE:include<span class="token punctuation">></span><span class="token punctuation">)</span>
</code></pre>
</li>
<li>
<p>puis on rajoute les bons exports aux autres fichiers</p>
</li>
<li>
<p>install ce fait sur un des 9 dossiers conventionnels de cmake (le plus connu etant <code>/lib/cmake/</code>)</p>
<pre class="language-cmake"><code class="language-CMake"><span class="token keyword">install</span><span class="token punctuation">(</span>
  EXPORT Conception-Orientee-ObjetTargets
  NAMESPACE Conception-Orientee-Objet::
  DESTINATION lib/cmake/Conception-Orientee-Objet<span class="token punctuation">)</span>

<span class="token keyword">include</span><span class="token punctuation">(</span>CMakePackageConfigHelpers<span class="token punctuation">)</span>
<span class="token function">configure_package_config_file</span><span class="token punctuation">(</span>
  Config.cmake.in Conception-Orientee-ObjetConfig.cmake
  INSTALL_DESTINATION lib/cmake/Conception-Orientee-Objet<span class="token punctuation">)</span>
<span class="token function">write_basic_package_version_file</span><span class="token punctuation">(</span>Conception-Orientee-ObjetConfigVersion.cmake
                                COMPATIBILITY AnyNewerVersion<span class="token punctuation">)</span>

<span class="token keyword">install</span><span class="token punctuation">(</span>FILES <span class="token string">"<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span></span>/Conception-Orientee-ObjetConfig.cmake"</span>
              <span class="token string">"<span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CMAKE_BINARY_DIR</span><span class="token punctuation">}</span></span>/Conception-Orientee-ObjetConfigVersion.cmake"</span>
        DESTINATION lib/cmake/Conception-Orientee-Objet<span class="token punctuation">)</span>
</code></pre>
</li>
<li>
<p><code>...target-release.cmake</code> compile en essayant d'optimiser le code (par defaut set at -03)</p>
<ul>
<li>optimisation -01 bof -02 bien
-03 et plus commence optimiser au point de ne plus rendre des resultats si exact</li>
</ul>
</li>
</ul>
<h3 id="commit-cmake-set-project_name">Commit: "CMake: set PROJECT_NAME"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-cmake-set-project_name"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/0426aa11ad7823d5adcb44c0a67fd2fcf1189e4f">lien vers le commit "CMake: set PROJECT_NAME"</a></p>
</blockquote>
<p>Dans ce commit on a simplifier les noms de variable pour eviter de s'y perdre avec le "-" et "_" ou les majuscules et minuscule en utilisant la syntax <code>${...}</code> pour remplacer une chaine de <code>char</code> comme sur <code>bash</code>.</p>
<h3 id="commit-test-packaging-">Commit: "test packaging "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-test-packaging-"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/78256ef172ce96a23a0a4849a465b1fa8ac76c6e">lien vers le commit "test packaging "</a></p>
</blockquote>
<ul>
<li>on rajoute un code pour faire les multiplications et on test le code</li>
<li>donc on va vouloir faire un build dans ce dossier multiplier</li>
<li>mais la commande cmake ne fonctionnera pas car il ne trouvera pas les fichiers .cmake</li>
<li>du coup on va rajouter le path vers les .cmake dans la variable <code>CMAKE_PREFIX_PATH</code>
<ul>
<li>similaire a <code>sys.path</code> de chez python ou encore <code>PTYHON_PATH</code></li>
<li>pour cela on fait <code>export CMAKE_PREFIX_PATH = /tmp/install</code></li>
</ul>
</li>
<li>on relance le build puis compiler et lancer les tests</li>
</ul>
<h3 id="commit-ci-test-packaging-">Commit: "ci: test packaging "<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-ci-test-packaging-"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/7f63ead9eaf19036e4320d25618ef312a9fe6046">lien vers le commit "ci: test packaging "</a></p>
</blockquote>
<p>l'idée est d'automatiser les tests</p>
<p>On rajoute le job <code>packaging</code>:</p>
<pre class="language-yml"><code class="language-YML">  <span class="token key atrule">packaging</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> <span class="token string">"build"</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/download<span class="token punctuation">-</span>artifact@v3
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> build
        <span class="token key atrule">path</span><span class="token punctuation">:</span> build

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install the project
      <span class="token key atrule">run</span><span class="token punctuation">:</span> cmake <span class="token punctuation">-</span><span class="token punctuation">-</span>install build

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test packaging
      <span class="token key atrule">run</span><span class="token punctuation">:</span> cmake <span class="token punctuation">-</span>B test<span class="token punctuation">-</span>packaging <span class="token punctuation">-</span>S tests/multiply
      <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token key atrule">CMAKE_PREFIX_PATH</span><span class="token punctuation">:</span> <span class="token string">"${{ github.workspace }}/install"</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build subproject
      <span class="token key atrule">run</span><span class="token punctuation">:</span> cmake <span class="token punctuation">-</span><span class="token punctuation">-</span>build test<span class="token punctuation">-</span>packaging
</code></pre>
<p>Ceci va creer une action</p>
<blockquote>
<p>un fichier ML est un standard avec langage markup qui organise des donnees variables</p>
</blockquote>
<h3 id="commit-set-rpath">Commit: "set RPATH"<a aria-hidden="true" class="anchor-heading icon-link" href="#commit-set-rpath"></a></h3>
<blockquote>
<p><a href="https://github.com/nim65s/conception-orientee-objet/commit/e0d1188d0c249845ed94f065a29a007617886a86">lien vers le commit "set RPATH"</a></p>
</blockquote>
<p>Lorsqu'une erreur est cause parce que l'interpreteur ne trouve pas la lib alros mettre à jour la variable <code>LD_LIBRARY_PATH = /tmp/install/lib</code>.</p>
<p>Ces noms de variables sont important pour que des users puissent lancer le projet et adapter ces variables a leur context.</p>
<p>Mais apres avoir bcp de projet sur l'ordi on peut commencer a s'y perdre on va chercher a optimiser ces noms de variables avec <code>RPATH</code></p>
<p>Pour cela on rajoute dans le cmakelist principal cette ligne</p>
<pre><code>set_target_properties(adder PROPERTIES INSTALL_RPATH "$ORIGIN/../lib")
</code></pre>
<p>où <code>$Origin</code></p>
<p><code>/tmp/install/bin/../lib/</code> == <code>/tmp/install/lib/</code> </p>
<h2 id="commande-pour-modifier-le-path">Commande pour modifier le PATH<a aria-hidden="true" class="anchor-heading icon-link" href="#commande-pour-modifier-le-path"></a></h2>
<ul>
<li>
<p><code>exprt $PATH=Path1:Path2:${PATH}</code> où par exemple PATH etait egal avant l'expor à <code>Path3:Path4:Path5</code></p>
<ul>
<li>du coup <code>echo $PATH</code> retournera : <code>Path1:Path2:Path3:Path4:Path5</code></li>
</ul>
</li>
<li>
<p><code>objdump -x /tmp/install/bin/adder</code></p>
<ul>
<li>pour explorer du code binaire</li>
<li>indique des informations utiles liée à cette executable comme la lib, l'architecture, ...</li>
</ul>
</li>
</ul>
<blockquote>
<p>Notes du 2022/09/14 - End</p>
</blockquote>
<hr>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/UT3-AURO-2223-S10-Dendron/notes/tpyb41n9fi7ze4cw7z2cuxo">COOSATR - Conception Orientee Objet</a></li>
</ul>