<h1 id="tp1---connect-4">TP1 - Connect 4<a aria-hidden="true" class="anchor-heading icon-link" href="#tp1---connect-4"></a></h1>
<blockquote>
<p><strong>Avertissement:</strong>
Cette page peut contenir des fautes ! Envoyez-moi un message sur <a href="https://matrix.to/#/#UT3-AURO-M2-2223-Request:matrix.org"><code>#UT3-AURO-M2-2223-Request:matrix.org</code></a> si vous en trouvez, merci.</p>
</blockquote>
<blockquote>
<p>Cours donné par G. Saurel</p>
</blockquote>
<hr>
<h1 id="connect-4">Connect 4<a aria-hidden="true" class="anchor-heading icon-link" href="#connect-4"></a></h1>
<p>TP n°1 de Conception Orientée Objet pour le M2 auro.</p>
<h2 id="objectifs">Objectifs<a aria-hidden="true" class="anchor-heading icon-link" href="#objectifs"></a></h2>
<ol>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_dumb_6</code> et implémenter
<code>connect4.dump_ia.DumbIA.play</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_column_win</code> et améliorer
<code>connect4.game.Grid.win</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_tie</code> et implémenter
<code>connect4.game.Grid.tie</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau. <code>python -m connect4</code> devrait
également fonctionner.</li>
<li>implémenter <code>connect4.console_player.ConsolePlayer.play</code> jusqu’à ce que que le jeu soit utilisable avec
<code>python -m connect4 --player-a ConsolePlayer</code></li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_cheater</code> et implémenter <code>connect4.cheater_b</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau.</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_diag_win</code> et améliorer
<code>connect4.game.Grid.win</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau
<ul>
<li>Completer la section <code>diagonal</code> de <code>connect4.game.Grid.win</code> jusqu'à ce que l'unittest fonctionne</li>
</ul>
</li>
</ol>
<hr>
<h1 id="informations-utiles">Informations utiles<a aria-hidden="true" class="anchor-heading icon-link" href="#informations-utiles"></a></h1>
<p><a href="https://github.com/nim65s/connect4">Repo GitHub pour le TP1 Connect4</a></p>
<p>N.B.:</p>
<ul>
<li>Python fait croire que c'est un code interpreté (i.e. qui n'a pas besoin de compilation) alors quil conserve un cache de compilation en interne</li>
<li>Pypy lui est un code interpreté car il exécute directement</li>
<li>Appeler des méthodes en COO:
  Grid est la classe    
  grid est une instance de la classe Grid
  Il y a deux manière d'appeler la méthode place de la classe Grid
<ul>
<li>Grid.place(grid,j,Cell.B) aura besoin que l'on précise sur quel objet appliquer cette méthode</li>
<li>grid.place(j,Cell.B) n'aura pas besoin de préciser l'objet</li>
</ul>
</li>
</ul>
<h1 id="presentation-du-projet">Presentation du projet<a aria-hidden="true" class="anchor-heading icon-link" href="#presentation-du-projet"></a></h1>
<h2 id="class-cell">Class Cell<a aria-hidden="true" class="anchor-heading icon-link" href="#class-cell"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Cell</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    EMPTY <span class="token operator">=</span> <span class="token string">"."</span>
    A <span class="token operator">=</span> <span class="token string">"X"</span>
    B <span class="token operator">=</span> <span class="token string">"O"</span>
</code></pre>
<h2 id="class-grid">Class Grid<a aria-hidden="true" class="anchor-heading icon-link" href="#class-grid"></a></h2>
<blockquote>
<p>Toute les méthodes de toutes les classes continnent des <code>self</code> ! (Hors exception)</p>
</blockquote>
<pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Grid</span><span class="token punctuation">:</span>
    lines <span class="token operator">=</span> <span class="token number">6</span>
    columns <span class="token operator">=</span> <span class="token number">7</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>Cell<span class="token punctuation">.</span>EMPTY<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>columns <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        ret <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ret <span class="token operator">+=</span> <span class="token string">"|"</span>
            <span class="token keyword">for</span> column <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">:</span>
                ret <span class="token operator">+=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">.</span>value
            ret <span class="token operator">+=</span> <span class="token string">"|\n"</span>
        ret <span class="token operator">+=</span> <span class="token string">"+"</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>columns <span class="token operator">+</span> <span class="token string">"+\n"</span>
        ret <span class="token operator">+=</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>
        <span class="token keyword">return</span> ret

    <span class="token comment"># Place le jeton dans une colonne en le stoppant sur la premiere ligne libre (si elle existe)</span>
    <span class="token keyword">def</span> <span class="token function">place</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> cell<span class="token punctuation">:</span> Cell<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">==</span> Cell<span class="token punctuation">.</span>EMPTY<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> cell
                <span class="token keyword">return</span> line
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Column </span><span class="token interpolation"><span class="token punctuation">{</span>column<span class="token punctuation">}</span></span><span class="token string"> is full."</span></span><span class="token punctuation">)</span>

    <span class="token comment"># Verifier si 4 jetons sont alignees horizentalement, verticalement ou diagmt</span>
    <span class="token keyword">def</span> <span class="token function">win</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> column<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        adjacent <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># compteur</span>
        color <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span>
        <span class="token comment"># Horizontal</span>
        <span class="token keyword">for</span> cell <span class="token keyword">in</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>line<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> cell <span class="token operator">==</span> color<span class="token punctuation">:</span>
                adjacent <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">if</span> adjacent <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                adjacent <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token comment"># TODO: Vertical</span>
        <span class="token comment"># TODO: Diagonal</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token comment"># Condition d arret en cas de match nul</span>
    <span class="token keyword">def</span> <span class="token function">tie</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token comment"># TODO</span>
        <span class="token comment"># verifier si toutes les cases sont deja remplis</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre>
<h2 id="class-player">Class Player<a aria-hidden="true" class="anchor-heading icon-link" href="#class-player"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Player</span><span class="token punctuation">:</span>
    <span class="token comment"># fonction qui necessite de savoir l etat de la grille (donc en parametre)</span>
    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> grid<span class="token punctuation">:</span> Grid<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError
</code></pre>
<h2 id="class-game">Class Game<a aria-hidden="true" class="anchor-heading icon-link" href="#class-game"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Game</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> player_a<span class="token punctuation">:</span> Player<span class="token punctuation">,</span> player_b<span class="token punctuation">:</span> Player<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>player_a <span class="token operator">=</span> player_a
        self<span class="token punctuation">.</span>player_b <span class="token operator">=</span> player_b
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> Grid<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_a<span class="token punctuation">,</span> Cell<span class="token punctuation">.</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"A wins !"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>tie<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Tie."</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>self<span class="token punctuation">.</span>player_b<span class="token punctuation">,</span> Cell<span class="token punctuation">.</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Attention different de player.play</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"B wins !"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>tie<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Tie."</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

    <span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> player<span class="token punctuation">:</span> Player<span class="token punctuation">,</span> cell<span class="token punctuation">:</span> Cell<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        column <span class="token operator">=</span> player<span class="token punctuation">.</span>play<span class="token punctuation">(</span>self<span class="token punctuation">.</span>grid<span class="token punctuation">)</span>
        line <span class="token operator">=</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>place<span class="token punctuation">(</span>column<span class="token punctuation">,</span> cell<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>win<span class="token punctuation">(</span>line<span class="token punctuation">,</span> column<span class="token punctuation">)</span>
</code></pre>
<h1 id="execution">Execution<a aria-hidden="true" class="anchor-heading icon-link" href="#execution"></a></h1>
<ul>
<li><a href="/UT3-AURO-2223-S10-Dendron/"><strong>main</strong>.py</a></li>
</ul>
<p>Fichier qui crée un instance du jeu game avec un player A et B pour ensuite lancer le <code>game.main</code></p>
<p>Lancer ce fichier ne fonctionnera pas plustot lancer les tests</p>
<h2 id="test_gamepy">test_game.py<a aria-hidden="true" class="anchor-heading icon-link" href="#test_gamepy"></a></h2>
<ul>
<li><a href="https://github.com/nim65s/connect4/blob/main/tests/test_game.py">lien vers le fichier test_game.py</a></li>
</ul>
<ol>
<li>
<p>Lancer la commande <code>python3 -m unittest</code>
Retourne:</p>
<pre><code>ssss..ss
----------------------------------------------------------------------
Ran 8 tests in 0.001s

OK (skipped=6)
</code></pre>
</li>
<li>
<p>Vérifier que le test fonctionne réellement en y créant une erreur voulue</p>
<ul>
<li>Enlever une ligne de la grille</li>
<li>Relancer le test
Retourne:</li>
</ul>
<pre><code>ssssF.ss
======================================================================
FAIL: test_grid_str (tests.test_game.TestGame)
----------------------------------------------------------------------
Traceback (most recent call last):
File "/home/tunn/Documents/GitHub/connect4/tests/test_game.py", line 20, in test_grid_str
    self.assertEqual("\n" + str(grid), GRID_DUMB_6)
AssertionError: '\n|.[23 chars].....|\n|.......|\n|.......|\n|XOXOXO.|\n+-------+\n 0123456\n' != '\n|.[23 chars].....|\n|.......|\n|XOXOXO.|\n+-------+\n 0123456\n'

- |.......|
|.......|
|.......|
|.......|
|.......|
|XOXOXO.|
+-------+
0123456
</code></pre>
</li>
</ol>
<pre><code>----------------------------------------------------------------------
Ran 8 tests in 0.001s

FAILED (failures=1, skipped=6)
```
</code></pre>
<h1 id="travail-à-faire">Travail à faire<a aria-hidden="true" class="anchor-heading icon-link" href="#travail-à-faire"></a></h1>
<ol>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_dumb_6</code> et implémenter
<code>connect4.dump_ia.DumbIA.play</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau
<ul>
<li>L'IA doit simplement jouer une colonne si celle-ci est vide</li>
<li>Faire en sorte que l'on obtienne cette grille
<pre><code>|.......|
|.......|
|.......|
|.......|
|.......|
|XOXOXO.|
+-------+
0123456
</code></pre>
</li>
</ul>
</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_column_win</code> et améliorer
<code>connect4.game.Grid.win</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau
<ul>
<li>Completer la section <code>vertical</code> de <code>connect4.game.Grid.win</code> jusqu'à ce que l'unittest fonctionne</li>
</ul>
</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_tie</code> et implémenter
<code>connect4.game.Grid.tie</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau. <code>python -m connect4</code> devrait
également fonctionner.</li>
<li>implémenter <code>connect4.console_player.ConsolePlayer.play</code> jusqu’à ce que que le jeu soit utilisable avec
<code>python -m connect4 --player-a ConsolePlayer</code></li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_cheater</code> et implémenter <code>connect4.cheater_b</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau.</li>
<li>commenter le décorateur <code>skip</code> pour <code>tests.test_game.TestGame.test_diag_win</code> et améliorer
<code>connect4.game.Grid.win</code> jusqu’à ce que <code>python -m unittest</code> fonctionne à nouveau
<ul>
<li>Completer la section <code>diagonal</code> de <code>connect4.game.Grid.win</code> jusqu'à ce que l'unittest fonctionne</li>
</ul>
</li>
</ol>
<h1 id="notes-de-corrigé">Notes de Corrigé<a aria-hidden="true" class="anchor-heading icon-link" href="#notes-de-corrigé"></a></h1>
<p>Un façon de parcourrir un tableau de façon plus optimisé que de faire une double boucle</p>
<pre><code>ret.grid[n // ret.columns][n % ret.columns] = deserialize_cell(cell)
# //: div entier
# %: modulo
</code></pre>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/UT3-AURO-2223-S10-Dendron/notes/tpyb41n9fi7ze4cw7z2cuxo">COOSATR - Conception Orientee Objet</a></li>
</ul>