<h1 id="python-tooling">Python Tooling<a aria-hidden="true" class="anchor-heading icon-link" href="#python-tooling"></a></h1>
<p><strong>Source:</strong> <a href="https://gitlab.laas.fr/gsaurel/talks">GitLab Repo 'Talks'</a></p>
<hr>
<!--
id: u5fiyqsnwvglqvwg3zc12kv
title: Python Tooling
desc: ''
updated: 1664628178095
created: 1664628178095
theme: laas
author: Guilhem Saurel
mainfont: Source Serif 4
monofont: Source Code Pro
-->
<h2 id="this-presentation">This presentation<a aria-hidden="true" class="anchor-heading icon-link" href="#this-presentation"></a></h2>
<h3 id="available-at">Available at<a aria-hidden="true" class="anchor-heading icon-link" href="#available-at"></a></h3>
<p>\centering</p>
<p><a href="https://homepages.laas.fr/gsaurel/talks/python-tooling.pdf"><code>https://homepages.laas.fr/gsaurel/talks/ python-tooling.pdf</code></a></p>
<h3 id="under-license">Under License<a aria-hidden="true" class="anchor-heading icon-link" href="#under-license"></a></h3>
<p>\centering</p>
<p><img src="/UT3-AURO-2223-S10-Dendron/media/cc.png" alt="CC" style="">
<img src="/UT3-AURO-2223-S10-Dendron/media/by.png" alt="BY" style="">
<img src="/UT3-AURO-2223-S10-Dendron/media/sa.png" alt="SA" style=""></p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</a></p>
<h2 id="this-presentation-continued">This presentation (continued)<a aria-hidden="true" class="anchor-heading icon-link" href="#this-presentation-continued"></a></h2>
<h3 id="source">Source<a aria-hidden="true" class="anchor-heading icon-link" href="#source"></a></h3>
<p>\centering</p>
<p><a href="https://gitlab.laas.fr/gsaurel/talks/-/blob/main/python-tooling.md"><code>https://gitlab.laas.fr/gsaurel/talks : python-tooling.md</code></a></p>
<h3 id="discussions">Discussions<a aria-hidden="true" class="anchor-heading icon-link" href="#discussions"></a></h3>
<p>\centering</p>
<p>\url{<a href="https://im.laas.fr/%5C#/room/%5C#python-tooling:laas.fr%7D">https://im.laas.fr/\#/room/\#python-tooling:laas.fr}</a></p>
<h2 id="outline">Outline<a aria-hidden="true" class="anchor-heading icon-link" href="#outline"></a></h2>
<p>\tableofcontents</p>
<h1 id="motivation">Motivation<a aria-hidden="true" class="anchor-heading icon-link" href="#motivation"></a></h1>
<h2 id="import-this"><code>import this</code><a aria-hidden="true" class="anchor-heading icon-link" href="#import-this"></a></h2>
<p>The Zen of Python, by Tim Peters (extracts)</p>
<ul>
<li>Beautiful is better than ugly.</li>
<li>Readability counts.</li>
<li>There should be one-- and preferably only one --obvious way to do it.</li>
</ul>
<h2 id="write-readable-code">Write readable code<a aria-hidden="true" class="anchor-heading icon-link" href="#write-readable-code"></a></h2>
<blockquote>
<p>Code is read much more often than it is written</p>
</blockquote>
<p>\hfill --- Guido</p>
<p>. . .</p>
<ul>
<li>read → write</li>
<li>teamwork</li>
<li>future self</li>
</ul>
<h1 id="style">Style<a aria-hidden="true" class="anchor-heading icon-link" href="#style"></a></h1>
<h2 id="pep-8">PEP 8<a aria-hidden="true" class="anchor-heading icon-link" href="#pep-8"></a></h2>
<h3 id="style-guide-for-python-code">Style Guide for Python Code<a aria-hidden="true" class="anchor-heading icon-link" href="#style-guide-for-python-code"></a></h3>
<p><a href="https://peps.python.org/pep-0008/">https://peps.python.org/pep-0008/</a></p>
<ul>
<li>indentation: 4 spaces</li>
<li>maximum line length: 79</li>
<li>whitespaces</li>
<li>comments</li>
<li>naming</li>
</ul>
<h2 id="pep8--pycodestyle">pep8 → pycodestyle<a aria-hidden="true" class="anchor-heading icon-link" href="#pep8--pycodestyle"></a></h2>
<p><a href="https://github.com/PyCQA/pycodestyle">https://github.com/PyCQA/pycodestyle</a></p>
<p>. . .</p>
<pre><code>$ pycodestyle --first optparse.py
optparse.py:69:11: E401 multiple imports on one line
optparse.py:77:1: E302 expected 2 blank lines, found 1
optparse.py:88:5: E301 expected 1 blank line, found 0
optparse.py:347:31: E211 whitespace before '('
optparse.py:357:17: E201 whitespace after '{'
optparse.py:472:29: E221 multiple spaces before operator
</code></pre>
<h2 id="pep-257--pydocstyle">PEP 257 / pydocstyle<a aria-hidden="true" class="anchor-heading icon-link" href="#pep-257--pydocstyle"></a></h2>
<p><a href="https://github.com/PyCQA/pydocstyle">https://github.com/PyCQA/pydocstyle</a></p>
<p>Mostly helps as a reminder to write some doc</p>
<pre><code>$ pydocstyle test.py
test.py:18 in private nested class `meta`:
        D101: Docstring missing
test.py:27 in public function `get_user`:
    D300: Use """triple double quotes""" (found '''-quotes)
test:75 in public function `init_database`:
    D201: No blank lines allowed before function docstring (found 1)
</code></pre>
<h2 id="flake8">flake8<a aria-hidden="true" class="anchor-heading icon-link" href="#flake8"></a></h2>
<p><a href="https://github.com/PyCQA/flake8">https://github.com/PyCQA/flake8</a></p>
<p>pycodestyle  + pyflakes + mccabe</p>
<h2 id="yapf">yapf<a aria-hidden="true" class="anchor-heading icon-link" href="#yapf"></a></h2>
<p><a href="https://github.com/google/yapf">https://github.com/google/yapf</a></p>
<p>clang-format / gofmt</p>
<pre class="language-python"><code class="language-python">x <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'a'</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">42</span><span class="token punctuation">,</span>

<span class="token string">'c'</span><span class="token punctuation">:</span><span class="token number">927</span><span class="token punctuation">}</span>
</code></pre>
<p>. . .</p>
<pre class="language-python"><code class="language-python">x <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token number">927</span><span class="token punctuation">}</span>
</code></pre>
<h2 id="black">black<a aria-hidden="true" class="anchor-heading icon-link" href="#black"></a></h2>
<p><a href="https://github.com/psf/black">https://github.com/psf/black</a></p>
<p><img src="/UT3-AURO-2223-S10-Dendron/media/black.png" alt="black"></p>
<h2 id="black-main-caveat">black main caveat<a aria-hidden="true" class="anchor-heading icon-link" href="#black-main-caveat"></a></h2>
<pre class="language-python"><code class="language-python">super_long_line<span class="token punctuation">.</span>with_small_argument <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># some comment</span>
</code></pre>
<p>. . .</p>
<pre class="language-python"><code class="language-python">super_long_line<span class="token punctuation">.</span>with_small_argument <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">0</span>
<span class="token punctuation">]</span>  <span class="token comment"># some comment</span>
</code></pre>
<p>. . .</p>
<pre class="language-python"><code class="language-python"><span class="token comment"># some comment</span>
super_long_line<span class="token punctuation">.</span>with_small_argument <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="isort">isort<a aria-hidden="true" class="anchor-heading icon-link" href="#isort"></a></h2>
<p><a href="https://github.com/PyCQA/isort">https://github.com/PyCQA/isort</a></p>
<p>sorts imports.</p>
<h1 id="packaging">Packaging<a aria-hidden="true" class="anchor-heading icon-link" href="#packaging"></a></h1>
<h2 id="poetry">Poetry<a aria-hidden="true" class="anchor-heading icon-link" href="#poetry"></a></h2>
<p><a href="https://github.com/python-poetry/poetry">https://github.com/python-poetry/poetry</a></p>
<ul>
<li><code>poetry init</code></li>
<li><code>pyproject.toml</code></li>
<li>minimal python version</li>
<li>dependencies / dev-dependencies</li>
<li>virtualenv</li>
<li>sdist / wheel builder</li>
</ul>
<h2 id="others">Others<a aria-hidden="true" class="anchor-heading icon-link" href="#others"></a></h2>
<p>ref. "<a href="https://homepages.laas.fr/gsaurel/talks/managing-python-packages.pdf">Managing Python Packages</a>"</p>
<h1 id="tests">Tests<a aria-hidden="true" class="anchor-heading icon-link" href="#tests"></a></h1>
<h2 id="unittest">unittest<a aria-hidden="true" class="anchor-heading icon-link" href="#unittest"></a></h2>
<p><a href="https://docs.python.org/3/library/unittest.html">https://docs.python.org/3/library/unittest.html</a></p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> unittest

<span class="token keyword">class</span> <span class="token class-name">TestStringMethods</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">test_upper</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'FOO'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_isupper</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'FOO'</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertFalse<span class="token punctuation">(</span><span class="token string">'Foo'</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="unittest-launch">unittest launch<a aria-hidden="true" class="anchor-heading icon-link" href="#unittest-launch"></a></h2>
<pre><code>$ python test_string.py
..
--------------------------------------------------
Ran 2 tests in 0.000s

OK

</code></pre>
<p>. . .</p>
<p>ou</p>
<pre><code>$ python -m unittest
..
--------------------------------------------------
Ran 2 tests in 0.000s

OK
</code></pre>
<h2 id="doctest">doctest<a aria-hidden="true" class="anchor-heading icon-link" href="#doctest"></a></h2>
<p><a href="https://docs.python.org/3/library/doctest.html">https://docs.python.org/3/library/doctest.html</a></p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Return the factorial of n, an exact integer >= 0.

    >>> [factorial(n) for n in range(6)]
    [1, 1, 2, 6, 24, 120]
    >>> factorial(30)
    265252859812191058636308480000000
    >>> factorial(-1)
    Traceback (most recent call last):
        ...
    ValueError: n must be >= 0
    """</span>

</code></pre>
<h2 id="doctest-launch">doctest launch<a aria-hidden="true" class="anchor-heading icon-link" href="#doctest-launch"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> doctest
    doctest<span class="token punctuation">.</span>testmod<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="others-1">Others<a aria-hidden="true" class="anchor-heading icon-link" href="#others-1"></a></h2>
<ul>
<li>pytest</li>
<li>tox</li>
</ul>
<h1 id="coverage">Coverage<a aria-hidden="true" class="anchor-heading icon-link" href="#coverage"></a></h1>
<h2 id="coveragepy">Coverage.py<a aria-hidden="true" class="anchor-heading icon-link" href="#coveragepy"></a></h2>
<p><a href="https://github.com/nedbat/coveragepy">https://github.com/nedbat/coveragepy</a></p>
<pre><code>$ coverage run -m unittest discover
$ coverage report -m
Name                  Stmts   Miss  Cover   Missing
---------------------------------------------------
my_program.py            20      4    80%   33-35, 39
my_other_module.py       56      6    89%   17-23
---------------------------------------------------
TOTAL                    76     10    87%
</code></pre>
<p>. . .</p>
<pre><code>$ coverage html
</code></pre>
<p><a href="https://nedbatchelder.com/files/sample_coverage_html/index.html">sample</a></p>
<h2 id="online">online<a aria-hidden="true" class="anchor-heading icon-link" href="#online"></a></h2>
<ul>
<li><a href="https://coveralls.io/">https://coveralls.io/</a></li>
<li><a href="https://about.codecov.io/">https://about.codecov.io/</a></li>
</ul>
<h2 id="gitlab">Gitlab<a aria-hidden="true" class="anchor-heading icon-link" href="#gitlab"></a></h2>
<p>Settings → CI/CD → General pipelines → Test coverage parsing</p>
<h1 id="static-analysis">Static analysis<a aria-hidden="true" class="anchor-heading icon-link" href="#static-analysis"></a></h1>
<h2 id="mypy-motivation">Mypy: motivation<a aria-hidden="true" class="anchor-heading icon-link" href="#mypy-motivation"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Performs addition on integers.

    >>> add(3, 4)
    7
    """</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> sys

    <span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="mypy">Mypy<a aria-hidden="true" class="anchor-heading icon-link" href="#mypy"></a></h2>
<pre><code>$ python add.py 3 4
34
</code></pre>
<p>. . .</p>
<pre><code>$ mypy add.py
add.py:13: error: Argument 1 to "add" has incompatible
                  type "str"; expected "int"
add.py:13: error: Argument 2 to "add" has incompatible
                  type "str"; expected "int"
Found 2 errors in 1 file (checked 1 source file)
</code></pre>
<h2 id="pyupgrade">pyupgrade<a aria-hidden="true" class="anchor-heading icon-link" href="#pyupgrade"></a></h2>
<p><a href="https://github.com/asottile/pyupgrade">https://github.com/asottile/pyupgrade</a></p>
<pre class="language-diff"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">class C(Base):
</span><span class="token prefix unchanged"> </span><span class="token line">    def f(self):
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">        super(C, self).f()
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        super().f()
</span></span></code></pre>
<h2 id="pylint">Pylint<a aria-hidden="true" class="anchor-heading icon-link" href="#pylint"></a></h2>
<p>pass…</p>
<h1 id="meta">Meta<a aria-hidden="true" class="anchor-heading icon-link" href="#meta"></a></h1>
<h2 id="editor--ide-integration">Editor / IDE integration<a aria-hidden="true" class="anchor-heading icon-link" href="#editor--ide-integration"></a></h2>
<p>Bring your own ;)</p>
<h2 id="pre-commit">pre-commit<a aria-hidden="true" class="anchor-heading icon-link" href="#pre-commit"></a></h2>
<p><a href="https://github.com/pre-commit/pre-commit">https://github.com/pre-commit/pre-commit</a></p>
<p><code>.pre-commit-config.yaml</code></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">repos</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span>   <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/pre<span class="token punctuation">-</span>commit/pre<span class="token punctuation">-</span>commit<span class="token punctuation">-</span>hooks
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> v4.2.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> check<span class="token punctuation">-</span>yaml
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> end<span class="token punctuation">-</span>of<span class="token punctuation">-</span>file<span class="token punctuation">-</span>fixer
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> trailing<span class="token punctuation">-</span>whitespace
<span class="token punctuation">-</span>   <span class="token key atrule">repo</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/psf/black
    <span class="token key atrule">rev</span><span class="token punctuation">:</span> 22.3.0
    <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>   <span class="token key atrule">id</span><span class="token punctuation">:</span> black
</code></pre>
<h2 id="pre-commit-usage">pre-commit usage<a aria-hidden="true" class="anchor-heading icon-link" href="#pre-commit-usage"></a></h2>
<pre><code>pre-commit run -a
</code></pre>
<p>. . .</p>
<pre><code>pre-commit install
</code></pre>
<p>. . .</p>
<p>demo</p>
<h2 id="pre-commit-ci">pre-commit CI<a aria-hidden="true" class="anchor-heading icon-link" href="#pre-commit-ci"></a></h2>
<p><a href="https://pre-commit.ci/">https://pre-commit.ci/</a></p>
<h2 id="badges">Badges<a aria-hidden="true" class="anchor-heading icon-link" href="#badges"></a></h2>
<ul>
<li><img src="/UT3-AURO-2223-S10-Dendron/media/codecov.png"></li>
<li><img src="/UT3-AURO-2223-S10-Dendron/media/pre-commit-ci.png"></li>
<li><img src="/UT3-AURO-2223-S10-Dendron/media/badge-black.png"></li>
<li><img src="/UT3-AURO-2223-S10-Dendron/media/gitlab.png"></li>
</ul>
<h2 id="questions-">Questions ?<a aria-hidden="true" class="anchor-heading icon-link" href="#questions-"></a></h2>
<p>Thanks for your time :)</p>
<h2 id="proposition">Proposition<a aria-hidden="true" class="anchor-heading icon-link" href="#proposition"></a></h2>
<ul>
<li>flake8</li>
<li>black</li>
<li>isort</li>
<li>pyupgrade</li>
<li>pre-commit</li>
</ul>